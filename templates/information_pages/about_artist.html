{% extends "base.html" %}
{% block title %} –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø–µ—Å–Ω—é {% endblock %}

{% block content %}
{% if artist %}
<div style="margin-top: 75px;">
    <div class="recognize-window"
         style="margin-bottom: 10px; padding: 20px; border-radius: 10px; width: 96%;">
        <figure style="margin: 20px 0px; display: flex;">
            <img id="artist-img" width="200px" height="200px" style="border-radius: 50%; overflow: hidden; margin-right: 20px;"
                 src="{{ artist.background }}">
            <figcaption style="margin-left: 20px; align-self: center;">
                <div>
                    <b class="artist-name" style="font-size: 28px; color: white;">{{ artist.artist }}</b> <br><br>
                     <a class="artist-name" style="font-size: 14px; color: white;">üé∂–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ —Ç—Ä–µ–∫–æ–≤: {{ apt }}</a> <br>
                     <a class="artist-name" style="font-size: 14px; color: white;">
                         üéôÔ∏è–¢—Ä–µ–∫–æ–≤ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ: {{ platform_tracks }}</a> <br><br>
                    <a href="/artist/{{ artist.id }}" class="artist-link" style="font-size: 16px; color: white;">{{ artist.band }}</a>
                    <button class="share-button" onclick="toggleImage('{{ link }}')">
                        <img id="share-icon"
                             src="https://cdn-icons-png.freepik.com/256/2958/2958783.png?ga=GA1.1.1487335546.1713716169&semt=ais_hybrid"
                             class="share-icon" width="30" height="30" style="border: none;">
                    </button>
                </div>
            </figcaption>
        </figure>
        <div class="copy-link" style="margin-top: 20px;">
        </div>
    </div>
</div>

<h2 class="animated-text" style="font-family: 'Arial'; font-size: 25px; font-weight: bold; margin-top: 20px;">
    –õ—É—á—à–∏–µ –ø–µ—Å–Ω–∏
    –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è </h2>
<div class="row">
    {% for track in best_tracks %}
    <div class="col-md-3">
        <div class="charts-content-block" style="overflow: hidden;">
            <a href="/track/{{ track.id }}">
                <img width="200px" height="200px" class="charts-song-cover" src="{{ track.background }}">
            </a>
            <div style="font-weight: 500; margin-top: 10px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                <a href="/track/{{ track.id }}" style="font-size: 18px">{{ track.track }}</a><br>
                <a href="/artist/{{ track.artist_id }}" style="font-size: 14px; color: black;">{{ track.band }}</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<h2 class="animated-text" style="font-family: 'Arial'; font-size: 25px; font-weight: bold;"> –í—Å–µ –ø–µ—Å–Ω–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
    –Ω–∞
    –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ </h2>
<div class="row">
    {% for track in all_tracks %}
    <div class="col-md-3">
        <div class="charts-content-block" style="overflow: hidden;">
            <a href="/track/{{ track.id }}">
                <img width="200px" height="200px" class="charts-song-cover" src="{{ track.background }}">
            </a>
            <div style="font-weight: 500; margin-top: 10px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                <a href="/track/{{ track.id }}" style="font-size: 18px">{{ track.track }} </a><br>
                <a href="/artist/{{ track.artist_id }}" style="font-size: 14px; color: black;">{{ track.band }}</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div style="margin-top: 100px;">
    –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É –Ω–∞—Å –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–∞–Ω–Ω–æ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ...
</div>
{% endif %}

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ü–≤–µ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function getAverageColor(imageUrl, callback) {
        var img = new Image();
        img.crossOrigin = "Anonymous";
        img.onload = function() {
            var canvas = document.createElement('canvas');
            canvas.width = this.width;
            canvas.height = this.height;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(this, 0, 0);
            var pixelData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            var totalRed = 0, totalGreen = 0, totalBlue = 0;
            for (var i = 0; i < pixelData.length; i += 4) {
                totalRed += pixelData[i];
                totalGreen += pixelData[i + 1];
                totalBlue += pixelData[i + 2];
            }
            var averageRed = Math.round(totalRed / (pixelData.length / 4));
            var averageGreen = Math.round(totalGreen / (pixelData.length / 4));
            var averageBlue = Math.round(totalBlue / (pixelData.length / 4));
            var averageColor = 'rgb(' + averageRed + ',' + averageGreen + ',' + averageBlue + ')';
            callback(averageColor);
        };
        img.src = imageUrl;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    function getContrastColor(color) {
        var rgb = color.substring(4, color.length - 1).replace(/ /g, '').split(',');
        var brightness = Math.round(((parseInt(rgb[0]) * 299) +
            (parseInt(rgb[1]) * 587) +
            (parseInt(rgb[2]) * 114)) / 1000);
        return (brightness > 125) ? 'black' : 'white';
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–ª—è recognize-window –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
    var artistImg = document.getElementById('artist-img');
    getAverageColor(artistImg.src, function(averageColor) {
        var recognizeWindow = document.querySelector('.recognize-window');
        recognizeWindow.style.backgroundColor = averageColor;
        var artistName = document.querySelector('.artist-name');
        artistName.style.color = getContrastColor(averageColor);
        var artistLink = document.querySelector('.artist-link');
        artistLink.style.color = getContrastColor(averageColor);
    });

</script>
<script>
    function copyToClipboard(link) {
        navigator.clipboard.writeText(link)
    }

    function toggleImage(link) {
        var img = document.getElementById('share-icon');
        if (img.src === 'https://cdn-icons-png.freepik.com/256/2958/2958791.png?ga=GA1.1.1487335546.1713716169&semt=ais_hybrid') {
            img.src = 'https://cdn-icons-png.freepik.com/256/2958/2958783.png?ga=GA1.1.1487335546.1713716169&semt=ais_hybrid';
        } else {
            img.src = 'https://cdn-icons-png.freepik.com/256/2958/2958791.png?ga=GA1.1.1487335546.1713716169&semt=ais_hybrid';
        }
        copyToClipboard(link);
    }
</script>

<style>
    .share-button {
        border: 0px solid #333;
        border-radius: 20px;
        padding: 5px;
        background-color: transparent;
    }
</style>
{% endblock %}
